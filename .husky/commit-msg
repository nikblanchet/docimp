#!/usr/bin/env sh
set -e
# commit-msg hook: Reject forbidden emojis in commit messages
#
# This is a global hook (committed to repo) that applies to all contributors.
# Rejects commits containing unprofessional emojis commonly added by AI tools.
#
# To bypass this check temporarily (for emergencies):
#   git commit --no-verify

commit_msg_file=$1

# Extract just the commit message (before any diff/patch content)
# This prevents false positives when commits remove emojis from code
commit_msg=$(sed '/^---$/q;/^diff /q' "$commit_msg_file" | sed '$d')

# Forbidden emojis (commonly added by AI tools)
FORBIDDEN_EMOJIS="ü§ñ ‚úÖ ‚ùå üöÄ üö´ ‚ú® ‚ù§Ô∏è"

detected=""
for emoji in $FORBIDDEN_EMOJIS; do
    if printf '%s' "$commit_msg" | grep -q "$emoji"; then
        detected="$emoji"
        break
    fi
done

if [ -n "$detected" ]; then
    echo ""
    echo "COMMIT REJECTED"
    echo ""
    echo "Commit message contains forbidden emoji: $detected"
    echo "Please remove emojis from your commit message."
    echo ""
    echo "To bypass (emergencies only): git commit --no-verify"
    echo ""
    exit 1
fi

# Call local hook if it exists (for personal/machine-specific rules)
GIT_COMMON_DIR=$(git rev-parse --git-common-dir)
if [ -x "$GIT_COMMON_DIR/hooks/commit-msg" ]; then
    "$GIT_COMMON_DIR/hooks/commit-msg" "$@" || exit $?
fi
